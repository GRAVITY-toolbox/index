<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gravityギフト計算機</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');
        
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #0f172a;
            color: #f1f5f9;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
        }

        #app-container {
            width: 100%;
            max-width: 380px;
            height: 100%;
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
        }

        /* カスタムスクロールバー */
        ::-webkit-scrollbar {
            width: 3px;
        }
        ::-webkit-scrollbar-track {
            background: transparent; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }

        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }

        .pop { animation: pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* タブのアクティブスタイル */
        .tab-btn.active {
            background-color: rgba(51, 65, 85, 0.8);
            color: #fff;
            border-bottom: 2px solid #a78bfa; /* purple-400 */
        }
        .tab-btn {
            color: #94a3b8;
            transition: all 0.3s;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="app-container">
        
        <!-- ヘッダー: 上部に空間を追加 (pt-6) -->
        <header class="shrink-0 pt-6 px-4 bg-slate-900/90 backdrop-blur-md z-20">
            <div class="flex justify-between items-center mb-2 h-8">
                <h1 class="text-base font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-200 via-purple-200 to-pink-200">
                    <i class="fa-solid fa-calculator text-purple-400 mr-2"></i>Gravity計算機
                </h1>
                <!-- ギフト計算機タブのみリセットボタンを表示するためのラッパー -->
                <div id="reset-btn-wrapper">
                    <button onclick="resetAll()" class="text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 border border-slate-600 px-3 py-1.5 rounded transition-all active:scale-95">
                        <i class="fa-solid fa-rotate-right mr-1"></i>Reset
                    </button>
                </div>
            </div>

            <!-- タブ切り替え -->
            <div class="flex text-sm font-bold border-b border-slate-700/50">
                <button onclick="switchTab('gift')" id="btn-gift" class="tab-btn active flex-1 py-2 text-center rounded-t-lg">
                    ギフト計算
                </button>
                <button onclick="switchTab('box')" id="btn-box" class="tab-btn flex-1 py-2 text-center rounded-t-lg">
                    箱開け計算
                </button>
            </div>
        </header>

        <!-- コンテンツエリア -->
        <div class="flex-1 overflow-hidden relative">
            
            <!-- タブ1: ギフト計算機 -->
            <div id="tab-gift" class="h-full flex flex-col">
                <div class="flex-1 overflow-y-auto p-3 pb-32">
                    <div id="item-list" class="space-y-2">
                        <!-- アイテムリスト生成 -->
                    </div>
                </div>
                
                <!-- 固定フッター (ギフト用) -->
                <div class="shrink-0 bg-slate-900/95 backdrop-blur-xl border-t border-slate-700/50 z-30 pb-safe absolute bottom-0 w-full">
                    <div class="p-3">
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-slate-800/80 rounded-lg p-2 px-3 border border-yellow-500/20 flex flex-col justify-center">
                                <span class="text-yellow-500/70 font-bold text-[10px] uppercase tracking-wider">Total Kira</span>
                                <div class="flex items-baseline">
                                    <i class="fa-solid fa-star text-yellow-400 mr-1.5 text-sm"></i>
                                    <span id="total-kira" class="text-2xl font-bold text-yellow-100">0</span>
                                </div>
                            </div>
                            <div class="bg-slate-800/80 rounded-lg p-2 px-3 border border-cyan-500/20 flex flex-col justify-center">
                                <span class="text-cyan-500/70 font-bold text-[10px] uppercase tracking-wider">Total Points</span>
                                <div class="flex items-baseline">
                                    <span id="total-points" class="text-2xl font-bold text-cyan-100">0</span>
                                    <span class="text-xs text-cyan-500 font-bold ml-1">pt</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="h-4 w-full"></div>
                </div>
            </div>

            <!-- タブ2: 箱開け計算機 -->
            <div id="tab-box" class="h-full flex flex-col hidden overflow-y-auto p-4 pb-10">
                
                <!-- 入力エリア -->
                <div class="glass-card p-4 rounded-xl mb-4 space-y-4">
                    <!-- 初期ポイント -->
                    <div>
                        <label class="block text-slate-400 text-xs font-bold mb-2 uppercase tracking-wide">
                            初期ポイント
                        </label>
                        <div class="flex items-center bg-slate-900/50 border border-slate-600/50 rounded-lg px-3 py-2">
                            <i class="fa-solid fa-coins text-cyan-500 mr-3"></i>
                            <input type="number" id="initial-points" placeholder="0" value="50000"
                                class="bg-transparent w-full text-xl font-bold text-white placeholder-slate-600 focus:outline-none"
                                oninput="calculateBox()">
                        </div>
                    </div>

                    <!-- 参加人数 -->
                    <div>
                        <label class="block text-slate-400 text-xs font-bold mb-2 uppercase tracking-wide">
                            参加人数
                        </label>
                        <div class="relative">
                            <div class="flex items-center bg-slate-900/50 border border-slate-600/50 rounded-lg px-3 py-2">
                                <i class="fa-solid fa-users text-purple-400 mr-3"></i>
                                <select id="participant-count" 
                                    class="bg-transparent w-full text-xl font-bold text-white focus:outline-none appearance-none"
                                    onchange="calculateBox()">
                                    <!-- JSで1~10を生成 -->
                                </select>
                            </div>
                            <!-- カスタム矢印 -->
                            <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-slate-400">
                                <i class="fa-solid fa-caret-down"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 計算結果リスト -->
                <div id="box-list" class="space-y-2">
                    <!-- JSで生成 -->
                </div>
            </div>

        </div>

    </div>

    <script>
        // --- ギフト計算機用データ ---
        // 指示に従いリストを更新
        const itemsData = [
            { name: "宇宙遊園地", kira: 2590, points: 12950 },
            { name: "虹ユニコーン", kira: 1540, points: 7700 },
            { name: "ピクハート", kira: 1000, points: 5000 },
            { name: "ハート風船", kira: 790, points: 3950 },
            { name: "パフェ", kira: 500, points: 2500 },
            { name: "虹", kira: 250, points: 1250 },
            { name: "愛の花", kira: 250, points: 1250 },
            { name: "星の瓶", kira: 190, points: 950 },
            { name: "わくわくマイク", kira: 50, points: 250 },
            { name: "フィンちゃん", kira: 50, points: 250 },
            { name: "ハレハレ坊主", kira: 40, points: 200 },
            { name: "夜空の小瓶", kira: 40, points: 200 },
            { name: "クラウン", kira: 25, points: 125 },
            { name: "麗しの薔薇", kira: 25, points: 125 },
            { name: "紙ヒコウキ", kira: 25, points: 125 },
            { name: "サクラ", kira: 5, points: 25 },
            { name: "桃色ハート", kira: 5, points: 25 },
            { name: "栗ケーキ", kira: 5, points: 25 },
        ];

        // --- 箱開け計算機用データ ---
        const boxTargets = [
            { id: 1, target: 1000 },
            { id: 2, target: 6000 },
            { id: 3, target: 50000 },
            { id: 4, target: 100000 },
            { id: 5, target: 200000 },
            { id: 6, target: 500000 },
            { id: 7, target: 800000 },
        ];

        // DOM要素
        const itemListContainer = document.getElementById('item-list');
        const boxListContainer = document.getElementById('box-list');
        const totalKiraEl = document.getElementById('total-kira');
        const totalPointsEl = document.getElementById('total-points');
        const initialPointsInput = document.getElementById('initial-points');
        const resetBtnWrapper = document.getElementById('reset-btn-wrapper');
        const participantSelect = document.getElementById('participant-count');

        function init() {
            renderItems();
            initParticipants(); // 参加人数初期化
            renderBoxList(); // 箱リスト初期描画
            calculateTotal();
        }

        function initParticipants() {
            if (!participantSelect) return;
            participantSelect.innerHTML = '';
            for (let i = 1; i <= 10; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.text = i + '人';
                if (i === 10) option.selected = true; // 初期値10
                option.style.backgroundColor = '#1e293b'; // ダークモード用背景
                participantSelect.appendChild(option);
            }
        }

        // --- タブ切り替え ---
        window.switchTab = function(tabName) {
            const giftTab = document.getElementById('tab-gift');
            const boxTab = document.getElementById('tab-box');
            const giftBtn = document.getElementById('btn-gift');
            const boxBtn = document.getElementById('btn-box');

            if (tabName === 'gift') {
                giftTab.classList.remove('hidden');
                boxTab.classList.add('hidden');
                giftBtn.classList.add('active');
                boxBtn.classList.remove('active');
                // 位置ずれ防止のため visibility で制御
                resetBtnWrapper.style.visibility = 'visible';
            } else {
                giftTab.classList.add('hidden');
                boxTab.classList.remove('hidden');
                giftBtn.classList.remove('active');
                boxBtn.classList.add('active');
                // 位置ずれ防止のため visibility で制御
                resetBtnWrapper.style.visibility = 'hidden';
            }
        };

        // --- ギフト計算機ロジック ---
        function renderItems() {
            itemListContainer.innerHTML = '';
            itemsData.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = "glass-card p-3 rounded-xl flex items-center justify-between gap-3 relative group active:bg-slate-800/80 transition-colors";
                row.innerHTML = `
                    <div class="flex-1 min-w-0">
                        <div class="font-bold text-slate-200 text-sm mb-1.5 truncate">${item.name}</div>
                        <div class="flex items-center gap-3 text-xs text-slate-400 leading-none">
                            <div class="flex items-center"><i class="fa-solid fa-star text-yellow-500/80 mr-1 text-[10px]"></i><span>${item.kira.toLocaleString()}</span></div>
                            <div class="w-px h-3 bg-slate-700/50"></div>
                            <div class="flex items-center"><span class="text-cyan-500/80 font-bold mr-1 text-[10px]">PT</span><span>${item.points.toLocaleString()}</span></div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between bg-slate-900/40 rounded-lg p-1 border border-slate-700/30 w-28 shrink-0">
                        <button onclick="changeQuantity(${index}, -1)" class="w-8 h-8 rounded text-slate-400 hover:text-white hover:bg-slate-700 flex items-center justify-center active:scale-90 transition-transform"><i class="fa-solid fa-minus text-xs"></i></button>
                        <input type="number" id="qty-${index}" value="0" min="0" max="999" class="flex-1 text-center font-bold text-base text-slate-100 bg-transparent focus:outline-none focus:text-cyan-300 p-0" oninput="calculateTotal()" onclick="this.select()">
                        <button onclick="changeQuantity(${index}, 1)" class="w-8 h-8 rounded bg-slate-700/50 text-slate-200 hover:bg-slate-600 hover:text-white flex items-center justify-center active:scale-90 transition-transform border border-slate-600/50"><i class="fa-solid fa-plus text-xs"></i></button>
                    </div>
                `;
                itemListContainer.appendChild(row);
            });
        }

        window.changeQuantity = function(index, change) {
            const input = document.getElementById(`qty-${index}`);
            let val = parseInt(input.value) || 0;
            val += change;
            if (val < 0) val = 0;
            input.value = val;
            calculateTotal();
            input.classList.remove('pop');
            void input.offsetWidth;
            if(change > 0) input.classList.add('pop');
        };

        window.calculateTotal = function() {
            let totalKira = 0;
            let totalPoints = 0;
            itemsData.forEach((item, index) => {
                const input = document.getElementById(`qty-${index}`);
                const qty = parseInt(input.value) || 0;
                totalKira += item.kira * qty;
                totalPoints += item.points * qty;
            });
            totalKiraEl.textContent = totalKira.toLocaleString();
            totalPointsEl.textContent = totalPoints.toLocaleString();
            
            totalKiraEl.classList.remove('pop');
            totalPointsEl.classList.remove('pop');
            void totalKiraEl.offsetWidth;
            totalKiraEl.classList.add('pop');
            totalPointsEl.classList.add('pop');
        };

        window.resetAll = function() {
            itemsData.forEach((_, index) => {
                document.getElementById(`qty-${index}`).value = 0;
            });
            calculateTotal();
        }

        // --- 箱開け計算機ロジック ---
        function renderBoxList() {
            boxListContainer.innerHTML = '';
            boxTargets.forEach((item) => {
                const row = document.createElement('div');
                row.className = "glass-card p-3 rounded-lg flex items-center justify-between";
                // 計算結果表示エリア
                row.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-slate-300">
                            ${item.id}
                        </div>
                        <div class="text-sm font-bold text-slate-200">
                            ${item.target.toLocaleString()}
                        </div>
                    </div>
                    <div class="text-right">
                         <div class="text-[9px] text-slate-400 mb-0.5">1人当たりのポイント数</div>
                         <div class="flex flex-col items-end">
                             <div class="text-lg font-bold text-cyan-300 leading-none mb-1" id="box-result-pt-${item.id}">
                                0
                             </div>
                             <!-- キラ値表示 -->
                             <div class="flex items-center text-xs text-yellow-200/80 bg-slate-900/40 px-1.5 py-0.5 rounded border border-yellow-500/10">
                                <i class="fa-solid fa-star text-[9px] mr-1 text-yellow-500"></i>
                                <span id="box-result-kira-${item.id}">0</span>
                             </div>
                         </div>
                    </div>
                `;
                boxListContainer.appendChild(row);
            });
            // 初期計算
            calculateBox();
        }

        window.calculateBox = function() {
            const initial = parseInt(initialPointsInput.value) || 0;
            const participants = parseInt(participantSelect.value) || 10;
            
            boxTargets.forEach((item) => {
                const ptEl = document.getElementById(`box-result-pt-${item.id}`);
                const kiraEl = document.getElementById(`box-result-kira-${item.id}`);
                const kiraContainer = kiraEl.parentElement;

                // 1人あたり必要ポイント = (目標 - 初期) / 人数 (切り上げ)
                let requiredPt = Math.ceil((item.target - initial) / participants);
                
                // キラ値 = 必要ポイント / 5 (切り上げ)
                let requiredKira = Math.ceil(requiredPt / 5);
                
                ptEl.textContent = requiredPt.toLocaleString();
                kiraEl.textContent = requiredKira.toLocaleString();
                
                if (requiredPt <= 0) {
                    ptEl.classList.remove('text-cyan-300');
                    ptEl.classList.add('text-green-400'); // 達成済み
                    ptEl.textContent = "達成!";
                    kiraContainer.classList.add('hidden'); // 達成時はキラ値隠す
                } else {
                    ptEl.classList.add('text-cyan-300');
                    ptEl.classList.remove('text-green-400');
                    kiraContainer.classList.remove('hidden');
                }
            });
        }

        init();

    </script>
</body>
</html>
